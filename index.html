<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>Home Brew Tracker</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="container" data-view="list">
      <!-- List view -->
      <section id="list-view" class="list-view">
        <nav>
          <h1>My Brews</h1>
          <button type="button" id="new-brew-toggle" class="secondary">
            + New Brew
          </button>
        </nav>

        <form id="start-brew-form" class="hidden">
          <label for="new-brew-name">Brew name</label>
          <input type="text" id="new-brew-name" required placeholder="e.g. Morgans Ginger Beer" />
          <label for="new-brew-notes">Notes (optional)</label>
          <textarea id="new-brew-notes" placeholder="Initial notes..."></textarea>
          <button type="submit">Create Brew</button>
          <button type="button" id="cancel-new-brew" class="secondary">Cancel</button>
        </form>

        <div id="card-list" class="card-list" aria-label="Brew list"></div>
        <p id="fetch-error" class="hidden" role="alert"></p>
      </section>

      <!-- Detail view -->
      <section id="detail-view" class="detail-view">
        <header class="detail-header">
          <button type="button" id="back-btn" class="back-link">← Back to Brews</button>
          <div class="brew-title-row">
            <h1 id="detail-name"></h1>
            <span id="status-badge" class="status-badge">FERMENTING</span>
          </div>
          <p class="brew-meta">
            <span id="start-date"></span>
            <span id="og-display"></span>
            <span id="current-sg-display"></span>
            <span id="completed-date" class="completed-meta"></span>
          </p>
          <div class="header-actions">
            <button type="button" id="add-reading-btn" class="primary">+ Add Reading</button>
            <button type="button" id="mark-complete-btn" class="secondary">Mark as complete</button>
          </div>
        </header>

        <div class="stats-grid">
          <article class="stat-card">
            <p class="stat-label">Current Gravity</p>
            <p class="stat-value" id="stat-current-sg">—</p>
          </article>
          <article class="stat-card">
            <p class="stat-label">ABV (Approx)</p>
            <p class="stat-value stat-highlight" id="stat-abv">—</p>
          </article>
          <article class="stat-card">
            <p class="stat-label">Days Fermenting</p>
            <p class="stat-value" id="stat-days">—</p>
          </article>
          <article class="stat-card">
            <p class="stat-label">Readings</p>
            <p class="stat-value" id="stat-readings">0</p>
          </article>
        </div>

        <article class="chart-card">
          <h3>Fermentation Progress</h3>
          <div class="chart-container">
            <canvas id="sg-chart" aria-label="SG readings over time"></canvas>
          </div>
        </article>

        <!-- Add Reading Modal/Form -->
        <dialog id="reading-dialog">
          <article>
            <header>
              <button type="button" id="close-reading-dialog" aria-label="Close" class="close-btn">&times;</button>
              <h3>Log New Reading</h3>
            </header>
            <form id="log-reading-form">
              <label for="reading-date">Date</label>
              <input type="date" id="reading-date" required />
              <label for="reading-sg">Specific Gravity (SG)</label>
              <input type="number" id="reading-sg" required placeholder="1046" min="900" max="1200" step="1" />
              <label for="reading-temp">Temperature (°C)</label>
              <input type="number" id="reading-temp" placeholder="20" step="0.1" />
              <button type="submit">Save Reading</button>
            </form>
          </article>
        </dialog>

        <!-- Mark as complete: date picker -->
        <dialog id="complete-dialog">
          <article>
            <header>
              <button type="button" id="complete-dialog-close" aria-label="Close" class="close-btn">&times;</button>
              <h3>Mark as complete</h3>
            </header>
            <form id="complete-dialog-form">
              <label for="complete-date">Completion date</label>
              <input type="date" id="complete-date" required />
              <button type="submit">Save</button>
            </form>
          </article>
        </dialog>

        <article class="detail-section">
          <header class="section-header">
            <h3>Notes</h3>
            <button type="button" id="comments-edit-btn" class="secondary small">Edit</button>
          </header>
          <div id="comments-display" class="comments-display"></div>
          <div id="comments-edit" class="comments-edit hidden">
            <textarea id="comments-textarea" rows="4"></textarea>
            <div class="edit-actions">
              <button type="button" id="comments-save">Save</button>
              <button type="button" id="comments-cancel" class="secondary">Cancel</button>
            </div>
          </div>
        </article>

        <article class="detail-section">
          <header class="section-header">
            <h3>Ingredients</h3>
          </header>
          <ul id="ingredients-list"></ul>
          <form id="add-ingredient-form" class="add-ingredient-form">
            <input type="text" id="ingredient-item" placeholder="Item name" />
            <input type="number" id="ingredient-cost" placeholder="Cost" min="0" step="0.01" />
            <button type="submit">Add</button>
          </form>
          <p class="total-cost">Total: $<span id="ingredients-total">0.00</span></p>
        </article>
      </section>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
  </body>
</html>
